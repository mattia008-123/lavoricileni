<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cat vs Dog - Single File</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>

  <style>
    body {
      font-family: Arial;
      text-align: center;
      padding: 20px;
    }
    img {
      margin-top: 20px;
      max-width: 300px;
    }
  </style>
</head>

<body>

<h2>Riconoscimento Gatto vs Cane</h2>

<input type="file" accept="image/*" capture="camera" id="imageInput">
<br>
<img id="preview">
<p id="result">Caricamento modello...</p>

<script>
let model;

async function init() {
  model = await mobilenet.load();
  document.getElementById("result").innerText = "Modello pronto! Carica un'immagine.";
}

init();

document.getElementById("imageInput").addEventListener("change", async (event) => {
  const file = event.target.files[0];
  const img = document.getElementById("preview");
  img.src = URL.createObjectURL(file);

  img.onload = async () => {
    const predictions = await model.classify(img);

   function isDog(name){
  const dogBreeds = [
    "retriever","labrador","beagle","poodle","terrier","bulldog",
    "shepherd","husky","dalmatian","rottweiler","chihuahua",
    "pug","boxer","doberman","mastiff","corgi","greyhound",
    "hound","collie","akita","spaniel","dingo","wolf"
  ];
  name = name.toLowerCase();
  return dogBreeds.some(b => name.includes(b));
}

function isCat(name){
  const catBreeds = [
    "cat","kitten","tabby","siamese","persian","maine coon",
    "egyptian cat","tiger cat"
  ];
  name = name.toLowerCase();
  return catBreeds.some(c => name.includes(c));
}

const prediction = predictions[0];
let resultText = "Non riconosciuto";

if(isCat(prediction.className)){
  resultText = "üê± Gatto ("+(prediction.probability*100).toFixed(1)+"%)";
}
else if(isDog(prediction.className)){
  resultText = "üê∂ Cane ("+(prediction.probability*100).toFixed(1)+"%)";
}

document.getElementById("result").innerText = resultText;

    if (filtered) {
      document.getElementById("result").innerText =
        filtered.className + " (" + (filtered.probability * 100).toFixed(2) + "%)";
    } else {
      document.getElementById("result").innerText = "Non √® n√© gatto n√© cane.";
    }
  };
});
</script>

</body>
</html>